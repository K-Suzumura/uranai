<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å››æŸ±æ¨å‘½å ã„</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .input-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        .input-row {
            display: flex;
            gap: 20px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }
        .input-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        label {
            font-weight: bold;
            color: #555;
            white-space: nowrap;
        }
        input, select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 30px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            display: block;
            margin: 20px auto;
        }
        button:hover {
            background: #5a67d8;
        }
        .result-section {
            display: none;
        }
        .meishiki-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .meishiki-table th, .meishiki-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        .meishiki-table th {
            background: #667eea;
            color: white;
        }
        .pillar {
            background: #f8f9fa;
        }
        .analysis-section {
            margin-top: 30px;
            padding: 20px;
            background: #f0f0f0;
            border-radius: 8px;
        }
        .analysis-item {
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 5px;
        }
        .analysis-title {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        .element-balance {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .element-bar {
            flex: 1;
            text-align: center;
            padding: 5px;
            border-radius: 5px;
            color: white;
        }
        .wood { background: #4a7c59; }
        .fire { background: #e63946; }
        .earth { background: #8b4513; }
        .metal { background: #708090; }
        .water { background: #2a9d8f; }
        .stem-select, .branch-select {
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background: white;
        }
        .daiunn-section {
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        .daiunn-table {
            width: 100%;
            margin-top: 10px;
            font-size: 14px;
        }
        .daiunn-table th {
            background: #667eea;
            color: white;
            padding: 5px;
        }
        .daiunn-table td {
            padding: 5px;
            text-align: center;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”® å››æŸ±æ¨å‘½å ã„ ğŸ”®</h1>
        
        <div class="input-section">
            <h2>ç”Ÿå¹´æœˆæ—¥ã¨å‡ºç”Ÿæ™‚åˆ»ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h2>
            <div class="input-row">
                <div class="input-group">
                    <label>ç”Ÿå¹´æœˆæ—¥ï¼š</label>
                    <input type="date" id="birthDate" value="1990-01-01">
                </div>
                <div class="input-group">
                    <label>å‡ºç”Ÿæ™‚åˆ»ï¼š</label>
                    <input type="time" id="birthTime" value="12:00">
                </div>
                <div class="input-group">
                    <label>æ€§åˆ¥ï¼š</label>
                    <select id="gender">
                        <option value="male">ç”·æ€§</option>
                        <option value="female">å¥³æ€§</option>
                    </select>
                </div>
                <button onclick="calculate()">å‘½å¼ã‚’ç®—å‡ºã™ã‚‹</button>
            </div>
        </div>
        
        <div id="resultSection" class="result-section">
            <h2>å‘½å¼</h2>
            <table class="meishiki-table">
                <thead>
                    <tr>
                        <th>ç¨®é¡</th>
                        <th>æ™‚æŸ±</th>
                        <th>æ—¥æŸ±</th>
                        <th>æœˆæŸ±</th>
                        <th>å¹´æŸ±</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="pillar">
                        <td><strong>å¤©å¹²</strong></td>
                        <td>
                            <select id="hourStem" class="stem-select" onchange="updateAnalysis()">
                                <option value="">-</option>
                            </select>
                        </td>
                        <td style="background: #ffd700;">
                            <select id="dayStem" class="stem-select" onchange="updateAnalysis()">
                                <option value="">-</option>
                            </select>
                        </td>
                        <td>
                            <select id="monthStem" class="stem-select" onchange="updateAnalysis()">
                                <option value="">-</option>
                            </select>
                        </td>
                        <td>
                            <select id="yearStem" class="stem-select" onchange="updateAnalysis()">
                                <option value="">-</option>
                            </select>
                        </td>
                    </tr>
                    <tr class="pillar">
                        <td><strong>åœ°æ”¯</strong></td>
                        <td>
                            <select id="hourBranch" class="branch-select" onchange="updateAnalysis()">
                                <option value="">-</option>
                            </select>
                        </td>
                        <td>
                            <select id="dayBranch" class="branch-select" onchange="updateAnalysis()">
                                <option value="">-</option>
                            </select>
                        </td>
                        <td>
                            <select id="monthBranch" class="branch-select" onchange="updateAnalysis()">
                                <option value="">-</option>
                            </select>
                        </td>
                        <td>
                            <select id="yearBranch" class="branch-select" onchange="updateAnalysis()">
                                <option value="">-</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>è”µå¹²</strong></td>
                        <td id="hourHidden"></td>
                        <td id="dayHidden"></td>
                        <td id="monthHidden"></td>
                        <td id="yearHidden"></td>
                    </tr>
                    <tr>
                        <td><strong>åç¥</strong></td>
                        <td id="hourGod"></td>
                        <td>æ—¥ä¸»</td>
                        <td id="monthGod"></td>
                        <td id="yearGod"></td>
                    </tr>
                    <tr>
                        <td><strong>åäºŒé‹</strong></td>
                        <td id="hour12"></td>
                        <td id="day12"></td>
                        <td id="month12"></td>
                        <td id="year12"></td>
                    </tr>
                </tbody>
            </table>
            
            <div class="analysis-section">
                <h2>å ã„çµæœ</h2>
                <div id="analysisResult"></div>
            </div>
            
            <div class="daiunn-section" id="daiunnSection" style="display: none;">
                <h3>å¤§é‹ï¼ˆ10å¹´ã”ã¨ã®é‹å‹¢ï¼‰</h3>
                <div id="daiunnResult"></div>
            </div>
        </div>
    </div>

    <script>
        // åå¹²
        const heavenlyStems = ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸'];
        const stemElements = ['æœ¨', 'æœ¨', 'ç«', 'ç«', 'åœŸ', 'åœŸ', 'é‡‘', 'é‡‘', 'æ°´', 'æ°´'];
        const stemYinYang = ['é™½', 'é™°', 'é™½', 'é™°', 'é™½', 'é™°', 'é™½', 'é™°', 'é™½', 'é™°'];
        
        // åäºŒæ”¯
        const earthlyBranches = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];
        const branchElements = ['æ°´', 'åœŸ', 'æœ¨', 'æœ¨', 'åœŸ', 'ç«', 'ç«', 'åœŸ', 'é‡‘', 'é‡‘', 'åœŸ', 'æ°´'];
        
        // è”µå¹²
        const hiddenStems = {
            'å­': ['ç™¸'],
            'ä¸‘': ['å·±', 'ç™¸', 'è¾›'],
            'å¯…': ['ç”²', 'ä¸™', 'æˆŠ'],
            'å¯': ['ä¹™'],
            'è¾°': ['æˆŠ', 'ä¹™', 'ç™¸'],
            'å·³': ['ä¸™', 'æˆŠ', 'åºš'],
            'åˆ': ['ä¸', 'å·±'],
            'æœª': ['å·±', 'ä¸', 'ä¹™'],
            'ç”³': ['åºš', 'å£¬', 'æˆŠ'],
            'é…‰': ['è¾›'],
            'æˆŒ': ['æˆŠ', 'è¾›', 'ä¸'],
            'äº¥': ['å£¬', 'ç”²']
        };
        
        // åäºŒé‹
        const twelveStages = ['èƒ', 'é¤Š', 'é•·ç”Ÿ', 'æ²æµ´', 'å† å¸¯', 'å»ºç¦„', 'å¸æ—º', 'è¡°', 'ç—…', 'æ­»', 'å¢“', 'çµ¶'];
        
        // äºŒåå››ç¯€æ°—ï¼ˆæ¦‚ç®—ï¼‰
        const solarTerms = [
            {month: 1, day: 6, term: 'å°å¯’', zodiac: 'ä¸‘'},
            {month: 2, day: 4, term: 'ç«‹æ˜¥', zodiac: 'å¯…'},
            {month: 3, day: 6, term: 'å•“èŸ„', zodiac: 'å¯'},
            {month: 4, day: 5, term: 'æ¸…æ˜', zodiac: 'è¾°'},
            {month: 5, day: 6, term: 'ç«‹å¤', zodiac: 'å·³'},
            {month: 6, day: 6, term: 'èŠ’ç¨®', zodiac: 'åˆ'},
            {month: 7, day: 7, term: 'å°æš‘', zodiac: 'æœª'},
            {month: 8, day: 8, term: 'ç«‹ç§‹', zodiac: 'ç”³'},
            {month: 9, day: 8, term: 'ç™½éœ²', zodiac: 'é…‰'},
            {month: 10, day: 8, term: 'å¯’éœ²', zodiac: 'æˆŒ'},
            {month: 11, day: 8, term: 'ç«‹å†¬', zodiac: 'äº¥'},
            {month: 12, day: 7, term: 'å¤§é›ª', zodiac: 'å­'}
        ];
        
        // 60å¹²æ”¯è¡¨
        function getSixtyPillar(index) {
            const stemIndex = index % 10;
            const branchIndex = index % 12;
            return {
                stem: heavenlyStems[stemIndex],
                branch: earthlyBranches[branchIndex]
            };
        }
        
        // æœˆæ”¯ã‚’ç¯€å…¥ã‚Šã‹ã‚‰åˆ¤å®š
        function getMonthBranch(month, day) {
            for (let i = 0; i < solarTerms.length; i++) {
                const term = solarTerms[i];
                const nextTerm = solarTerms[(i + 1) % 12];
                
                if (month === term.month && day >= term.day) {
                    return term.zodiac;
                } else if (month === term.month && day < term.day) {
                    return solarTerms[(i + 11) % 12].zodiac;
                }
            }
            return solarTerms[month - 1].zodiac;
        }
        
        // åç¥åˆ¤å®š
        function getTenGod(dayStem, targetStem) {
            const dayIndex = heavenlyStems.indexOf(dayStem);
            const targetIndex = heavenlyStems.indexOf(targetStem);
            const dayElement = stemElements[dayIndex];
            const targetElement = stemElements[targetIndex];
            const dayYinYang = stemYinYang[dayIndex];
            const targetYinYang = stemYinYang[targetIndex];
            
            if (dayElement === targetElement) {
                return dayYinYang === targetYinYang ? 'æ¯”è‚©' : 'åŠ«è²¡';
            }
            
            const elementCycle = ['æœ¨', 'ç«', 'åœŸ', 'é‡‘', 'æ°´'];
            const dayElementIndex = elementCycle.indexOf(dayElement);
            const targetElementIndex = elementCycle.indexOf(targetElement);
            
            if ((dayElementIndex + 1) % 5 === targetElementIndex) {
                return dayYinYang === targetYinYang ? 'é£Ÿç¥' : 'å‚·å®˜';
            }
            if ((dayElementIndex + 2) % 5 === targetElementIndex) {
                return dayYinYang !== targetYinYang ? 'æ­£è²¡' : 'åè²¡';
            }
            if ((dayElementIndex + 3) % 5 === targetElementIndex) {
                return dayYinYang !== targetYinYang ? 'æ­£å®˜' : 'åå®˜';
            }
            if ((dayElementIndex + 4) % 5 === targetElementIndex) {
                return dayYinYang !== targetYinYang ? 'å°ç¶¬' : 'åå°';
            }
            
            return '';
        }
        
        // åäºŒé‹åˆ¤å®š
        function getTwelveStage(stem, branch) {
            const stemIndex = heavenlyStems.indexOf(stem);
            const branchIndex = earthlyBranches.indexOf(branch);
            const element = stemElements[stemIndex];
            
            const stageMap = {
                'æœ¨': [11, 6, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
                'ç«': [2, 9, 3, 4, 5, 6, 7, 8, 9, 10, 11, 0],
                'åœŸ': [5, 0, 6, 7, 8, 9, 10, 11, 0, 1, 2, 3],
                'é‡‘': [8, 3, 9, 10, 11, 0, 1, 2, 3, 4, 5, 6],
                'æ°´': [11, 6, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
            };
            
            const stageIndex = stageMap[element][branchIndex];
            return twelveStages[stageIndex];
        }
        
        // ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’åˆæœŸåŒ–
        function initializeSelects() {
            const stemSelects = document.querySelectorAll('.stem-select');
            const branchSelects = document.querySelectorAll('.branch-select');
            
            stemSelects.forEach(select => {
                select.innerHTML = '<option value="">-</option>';
                heavenlyStems.forEach(stem => {
                    const option = document.createElement('option');
                    option.value = stem;
                    option.textContent = stem;
                    select.appendChild(option);
                });
            });
            
            branchSelects.forEach(select => {
                select.innerHTML = '<option value="">-</option>';
                earthlyBranches.forEach(branch => {
                    const option = document.createElement('option');
                    option.value = branch;
                    option.textContent = branch;
                    select.appendChild(option);
                });
            });
        }
        
        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’åˆæœŸåŒ–
        window.onload = function() {
            initializeSelects();
        };
        
        function calculate() {
            const birthDate = new Date(document.getElementById('birthDate').value);
            const birthTime = document.getElementById('birthTime').value;
            const gender = document.getElementById('gender').value;
            const [hour, minute] = birthTime.split(':').map(Number);
            
            const year = birthDate.getFullYear();
            const month = birthDate.getMonth() + 1;
            const day = birthDate.getDate();
            
            // å¹´æŸ±è¨ˆç®—ï¼ˆç°¡æ˜“ç‰ˆï¼‰
            const yearIndex = (year - 1864) % 60;
            const yearPillar = getSixtyPillar(yearIndex);
            
            // æœˆæŸ±è¨ˆç®—
            const monthBranch = getMonthBranch(month, day);
            const monthBranchIndex = earthlyBranches.indexOf(monthBranch);
            const monthStemIndex = ((year % 10) * 2 + Math.floor(monthBranchIndex / 2)) % 10;
            const monthStem = heavenlyStems[monthStemIndex];
            
            // æ—¥æŸ±è¨ˆç®—ï¼ˆç°¡æ˜“ç‰ˆï¼‰
            const baseDate = new Date(1900, 0, 1);
            const daysDiff = Math.floor((birthDate - baseDate) / (1000 * 60 * 60 * 24));
            const dayIndex = daysDiff % 60;
            const dayPillar = getSixtyPillar(dayIndex);
            
            // æ™‚æŸ±è¨ˆç®—
            const hourBranchIndex = Math.floor((hour + 1) / 2) % 12;
            const hourBranch = earthlyBranches[hourBranchIndex];
            const dayStemIndex = heavenlyStems.indexOf(dayPillar.stem);
            const hourStemIndex = ((dayStemIndex % 5) * 2 + Math.floor(hourBranchIndex / 1)) % 10;
            const hourStem = heavenlyStems[hourStemIndex];
            
            // å‘½å¼è¡¨ç¤ºï¼ˆã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã«å€¤ã‚’è¨­å®šï¼‰
            document.getElementById('yearStem').value = yearPillar.stem;
            document.getElementById('yearBranch').value = yearPillar.branch;
            document.getElementById('monthStem').value = monthStem;
            document.getElementById('monthBranch').value = monthBranch;
            document.getElementById('dayStem').value = dayPillar.stem;
            document.getElementById('dayBranch').value = dayPillar.branch;
            document.getElementById('hourStem').value = hourStem;
            document.getElementById('hourBranch').value = hourBranch;
            
            // æ€§åˆ¥æƒ…å ±ã‚’ä¿å­˜ï¼ˆå¤§é‹è¨ˆç®—ã§ä½¿ç”¨ï¼‰
            window.currentGender = gender;
            window.currentBirthDate = birthDate;
            
            // åˆ†æã‚’æ›´æ–°
            updateAnalysis();
            
            document.getElementById('resultSection').style.display = 'block';
        }
        
        // å¤©å¹²ãƒ»åœ°æ”¯ãŒå¤‰æ›´ã•ã‚ŒãŸã¨ãã«å‘¼ã°ã‚Œã‚‹é–¢æ•°
        function updateAnalysis() {
            const yearStem = document.getElementById('yearStem').value;
            const monthStem = document.getElementById('monthStem').value;
            const dayStem = document.getElementById('dayStem').value;
            const hourStem = document.getElementById('hourStem').value;
            
            const yearBranch = document.getElementById('yearBranch').value;
            const monthBranch = document.getElementById('monthBranch').value;
            const dayBranch = document.getElementById('dayBranch').value;
            const hourBranch = document.getElementById('hourBranch').value;
            
            if (!dayStem) return; // æ—¥ä¸»ãŒé¸æŠã•ã‚Œã¦ã„ãªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„
            
            // è”µå¹²è¡¨ç¤º
            if (yearBranch) document.getElementById('yearHidden').textContent = hiddenStems[yearBranch].join('ãƒ»');
            if (monthBranch) document.getElementById('monthHidden').textContent = hiddenStems[monthBranch].join('ãƒ»');
            if (dayBranch) document.getElementById('dayHidden').textContent = hiddenStems[dayBranch].join('ãƒ»');
            if (hourBranch) document.getElementById('hourHidden').textContent = hiddenStems[hourBranch].join('ãƒ»');
            
            // åç¥è¡¨ç¤º
            if (yearStem) document.getElementById('yearGod').textContent = getTenGod(dayStem, yearStem);
            if (monthStem) document.getElementById('monthGod').textContent = getTenGod(dayStem, monthStem);
            if (hourStem) document.getElementById('hourGod').textContent = getTenGod(dayStem, hourStem);
            
            // åäºŒé‹è¡¨ç¤º
            if (yearStem && yearBranch) document.getElementById('year12').textContent = getTwelveStage(yearStem, yearBranch);
            if (monthStem && monthBranch) document.getElementById('month12').textContent = getTwelveStage(monthStem, monthBranch);
            if (dayStem && dayBranch) document.getElementById('day12').textContent = getTwelveStage(dayStem, dayBranch);
            if (hourStem && hourBranch) document.getElementById('hour12').textContent = getTwelveStage(hourStem, hourBranch);
            
            // åˆ†æå®Ÿè¡Œ
            analyzeDestiny(dayStem, [yearStem, monthStem, dayStem, hourStem],
                          [yearBranch, monthBranch, dayBranch, hourBranch]);
            
            // å¤§é‹ã‚‚è¨ˆç®—
            if (window.currentGender && window.currentBirthDate) {
                calculateDaiunn();
            }
        }
        
        function analyzeDestiny(dayStem, stems, branches) {
            const dayStemIndex = heavenlyStems.indexOf(dayStem);
            const dayElement = stemElements[dayStemIndex];
            const dayYinYang = stemYinYang[dayStemIndex];
            
            // äº”è¡Œãƒãƒ©ãƒ³ã‚¹è¨ˆç®—
            const elementCount = {
                'æœ¨': 0, 'ç«': 0, 'åœŸ': 0, 'é‡‘': 0, 'æ°´': 0
            };
            
            stems.forEach(stem => {
                const index = heavenlyStems.indexOf(stem);
                if (index !== -1) {
                    elementCount[stemElements[index]]++;
                }
            });
            
            branches.forEach(branch => {
                const index = earthlyBranches.indexOf(branch);
                if (index !== -1) {
                    elementCount[branchElements[index]]++;
                }
            });
            
            let analysisHTML = '';
            
            // æ—¥ä¸»ã®èª¬æ˜
            analysisHTML += `
                <div class="analysis-item">
                    <div class="analysis-title">æ—¥ä¸»ï¼ˆã‚ãªãŸã®æœ¬è³ªï¼‰</div>
                    <div>${dayStem}ï¼ˆ${dayYinYang}ã®${dayElement}ï¼‰</div>
                    <div>${getDayStemDescription(dayStem)}</div>
                </div>
            `;
            
            // äº”è¡Œãƒãƒ©ãƒ³ã‚¹
            analysisHTML += `
                <div class="analysis-item">
                    <div class="analysis-title">äº”è¡Œãƒãƒ©ãƒ³ã‚¹</div>
                    <div class="element-balance">
                        <div class="element-bar wood">æœ¨: ${elementCount['æœ¨']}</div>
                        <div class="element-bar fire">ç«: ${elementCount['ç«']}</div>
                        <div class="element-bar earth">åœŸ: ${elementCount['åœŸ']}</div>
                        <div class="element-bar metal">é‡‘: ${elementCount['é‡‘']}</div>
                        <div class="element-bar water">æ°´: ${elementCount['æ°´']}</div>
                    </div>
                    <div style="margin-top: 10px;">${getElementAnalysis(dayElement, elementCount)}</div>
                </div>
            `;
            
            // èº«å¼·ãƒ»èº«å¼±åˆ¤å®š
            const strength = judgeStrength(dayStem, stems, branches, elementCount);
            analysisHTML += `
                <div class="analysis-item">
                    <div class="analysis-title">èº«å¼·ãƒ»èº«å¼±åˆ¤å®š</div>
                    <div>${strength}</div>
                </div>
            `;
            
            // ç·åˆé‹å‹¢
            analysisHTML += `
                <div class="analysis-item">
                    <div class="analysis-title">ç·åˆé‹å‹¢</div>
                    <div>${getOverallFortune(dayStem, strength, elementCount)}</div>
                </div>
            `;
            
            document.getElementById('analysisResult').innerHTML = analysisHTML;
        }
        
        function getDayStemDescription(stem) {
            const descriptions = {
                'ç”²': 'å¤§æ¨¹ã®ã‚ˆã†ãªå­˜åœ¨æ„ŸãŒã‚ã‚Šã€ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã«å„ªã‚Œã¦ã„ã¾ã™ã€‚æ­£ç›´ã§çœŸã£ç›´ããªæ€§æ ¼ã§ã™ã€‚',
                'ä¹™': 'è‰èŠ±ã®ã‚ˆã†ãªæŸ”è»Ÿæ€§ãŒã‚ã‚Šã€å”èª¿æ€§ã«å¯Œã‚“ã§ã„ã¾ã™ã€‚ç¹Šç´°ã§ç¾çš„æ„Ÿè¦šã«å„ªã‚Œã¦ã„ã¾ã™ã€‚',
                'ä¸™': 'å¤ªé™½ã®ã‚ˆã†ãªæ˜ã‚‹ã•ãŒã‚ã‚Šã€æƒ…ç†±çš„ã§è¡Œå‹•åŠ›ãŒã‚ã‚Šã¾ã™ã€‚äººã‚’æƒ¹ãã¤ã‘ã‚‹é­…åŠ›ãŒã‚ã‚Šã¾ã™ã€‚',
                'ä¸': 'ã‚ã†ããã®ç«ã®ã‚ˆã†ãªå„ªã—ã„å…‰ã§ã€å‘¨å›²ã‚’æ¸©ã‹ãç…§ã‚‰ã—ã¾ã™ã€‚æ€æ…®æ·±ãçŒ®èº«çš„ã§ã™ã€‚',
                'æˆŠ': 'å±±ã®ã‚ˆã†ã«ã©ã£ã—ã‚Šã¨ã—ãŸå®‰å®šæ„ŸãŒã‚ã‚Šã€ä¿¡é ¼ã•ã‚Œã‚‹å­˜åœ¨ã§ã™ã€‚åŒ…å®¹åŠ›ãŒã‚ã‚Šã¾ã™ã€‚',
                'å·±': 'å¤§åœ°ã®ã‚ˆã†ãªæ¯æ€§çš„ãªå„ªã—ã•ãŒã‚ã‚Šã€è‚²ã‚€åŠ›ã«å„ªã‚Œã¦ã„ã¾ã™ã€‚å …å®Ÿã§çœŸé¢ç›®ã§ã™ã€‚',
                'åºš': 'åˆ€å‰£ã®ã‚ˆã†ãªé‹­ã•ãŒã‚ã‚Šã€æ±ºæ–­åŠ›ã¨å®Ÿè¡ŒåŠ›ã«å„ªã‚Œã¦ã„ã¾ã™ã€‚æ­£ç¾©æ„ŸãŒå¼·ã„ã§ã™ã€‚',
                'è¾›': 'å®çŸ³ã®ã‚ˆã†ãªç¹Šç´°ã•ã¨ç¾ã—ã•ãŒã‚ã‚Šã€ã‚»ãƒ³ã‚¹ã¨æ„Ÿæ€§ã«å„ªã‚Œã¦ã„ã¾ã™ã€‚å®Œç’§ä¸»ç¾©çš„ã§ã™ã€‚',
                'å£¬': 'å¤§æµ·ã®ã‚ˆã†ãªåŒ…å®¹åŠ›ãŒã‚ã‚Šã€çŸ¥è­˜æ¬²æ—ºç››ã§é©å¿œåŠ›ãŒã‚ã‚Šã¾ã™ã€‚è‡ªç”±ã‚’æ„›ã—ã¾ã™ã€‚',
                'ç™¸': 'é›¨éœ²ã®ã‚ˆã†ãªæ½¤ã„ã‚’ä¸ãˆã‚‹å­˜åœ¨ã§ã€çŸ¥æµã¨ç›´æ„ŸåŠ›ã«å„ªã‚Œã¦ã„ã¾ã™ã€‚ç¥ç§˜çš„ãªé­…åŠ›ãŒã‚ã‚Šã¾ã™ã€‚'
            };
            return descriptions[stem] || '';
        }
        
        function getElementAnalysis(dayElement, elementCount) {
            const total = Object.values(elementCount).reduce((a, b) => a + b, 0);
            const dayElementCount = elementCount[dayElement];
            const ratio = dayElementCount / total;
            
            if (ratio > 0.4) {
                return `æ—¥ä¸»ã®${dayElement}ã®æ°—ãŒå¼·ãã€è‡ªåˆ†ã®å€‹æ€§ã‚’ç™ºæ®ã—ã‚„ã™ã„å‘½å¼ã§ã™ã€‚`;
            } else if (ratio < 0.2) {
                return `æ—¥ä¸»ã®${dayElement}ã®æ°—ãŒå¼±ã‚ãªã®ã§ã€ã‚µãƒãƒ¼ãƒˆã—ã¦ãã‚Œã‚‹è¦ç´ ã‚’å¤§åˆ‡ã«ã—ã¾ã—ã‚‡ã†ã€‚`;
            } else {
                return `äº”è¡Œã®ãƒãƒ©ãƒ³ã‚¹ãŒå–ã‚Œã¦ãŠã‚Šã€èª¿å’Œçš„ãªå‘½å¼ã§ã™ã€‚`;
            }
        }
        
        function judgeStrength(dayStem, stems, branches, elementCount) {
            const dayStemIndex = heavenlyStems.indexOf(dayStem);
            const dayElement = stemElements[dayStemIndex];
            
            // åŒã˜äº”è¡Œã¨ç”Ÿã˜ã‚‹äº”è¡Œã®æ•°ã‚’æ•°ãˆã‚‹
            const supportElements = {
                'æœ¨': ['æœ¨', 'æ°´'],
                'ç«': ['ç«', 'æœ¨'],
                'åœŸ': ['åœŸ', 'ç«'],
                'é‡‘': ['é‡‘', 'åœŸ'],
                'æ°´': ['æ°´', 'é‡‘']
            };
            
            let supportCount = 0;
            supportElements[dayElement].forEach(element => {
                supportCount += elementCount[element];
            });
            
            // åŒã˜äº”è¡Œï¼ˆæ¯”åŠ«ï¼‰ã®æ•°ã‚’ç‰¹ã«é‡è¦–
            const sameElementCount = elementCount[dayElement];
            
            const total = Object.values(elementCount).reduce((a, b) => a + b, 0);
            const supportRatio = supportCount / total;
            const sameElementRatio = sameElementCount / total;
            
            // æœˆä»¤ã®å½±éŸ¿ã‚‚è€ƒæ…®
            const monthBranch = branches[1];
            const monthBranchIndex = earthlyBranches.indexOf(monthBranch);
            const monthElement = branchElements[monthBranchIndex];
            const hasMonthSupport = supportElements[dayElement].includes(monthElement);
            
            // 4æ®µéšåˆ¤å®š
            if (supportRatio > 0.65 || (supportRatio > 0.55 && hasMonthSupport) || sameElementRatio > 0.4) {
                return 'æ¥µèº«å¼·ï¼šæ—¥ä¸»ã®åŠ›ãŒéå¸¸ã«å¼·ãã€å¼·å¤§ãªã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’æŒã£ã¦ã„ã¾ã™ã€‚ãã®ãƒ‘ãƒ¯ãƒ¼ã‚’å»ºè¨­çš„ã«æ´»ç”¨ã—ã€å‘¨å›²ã¨ã®èª¿å’Œã‚’ç‰¹ã«æ„è­˜ã™ã‚‹ã“ã¨ãŒå¤§åˆ‡ã§ã™ã€‚';
            } else if (supportRatio > 0.5 || (supportRatio > 0.4 && hasMonthSupport)) {
                return 'èº«å¼·ï¼šæ—¥ä¸»ã®åŠ›ãŒå¼·ãã€è‡ªä¿¡ã¨è¡Œå‹•åŠ›ã«æº€ã¡ã¦ã„ã¾ã™ã€‚ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’ç™ºæ®ã—ã¤ã¤ã€ä»–è€…ã¸ã®é…æ…®ã‚‚å¤§åˆ‡ã«ã—ã¾ã—ã‚‡ã†ã€‚';
            } else if (supportRatio > 0.35 || (supportRatio > 0.25 && hasMonthSupport)) {
                return 'èº«å¼±ï¼šæ—¥ä¸»ã‚’æ”¯ãˆã‚‹è¦ç´ ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€ã‚ˆã‚ŠåŠ›ã‚’ç™ºæ®ã§ãã¾ã™ã€‚å”åŠ›è€…ã¨ã®é€£æºã‚’å¤§åˆ‡ã«ã—ã€ç„¡ç†ã®ãªã„ç¯„å›²ã§æ´»å‹•ã—ã¾ã—ã‚‡ã†ã€‚';
            } else {
                return 'æ¥µèº«å¼±ï¼šæ—¥ä¸»ã®åŠ›ãŒéå¸¸ã«å¼±ã„çŠ¶æ…‹ã§ã™ã€‚ã‚µãƒãƒ¼ãƒˆã—ã¦ãã‚Œã‚‹ç’°å¢ƒã‚„äººé–“é–¢ä¿‚ã‚’ç‰¹ã«å¤§åˆ‡ã«ã—ã€è‡ªåˆ†ã«åˆã£ãŸãƒšãƒ¼ã‚¹ã§ç€å®Ÿã«é€²ã‚€ã“ã¨ãŒé‡è¦ã§ã™ã€‚';
            }
        }
        
        function getOverallFortune(dayStem, strength, elementCount) {
            const dayStemIndex = heavenlyStems.indexOf(dayStem);
            const dayElement = stemElements[dayStemIndex];
            
            let fortune = `ã‚ãªãŸã¯${dayStem}ã®ç”Ÿã¾ã‚Œã§ã€${dayElement}ã®æ€§è³ªã‚’æŒã£ã¦ã„ã¾ã™ã€‚`;
            
            if (strength.includes('æ¥µèº«å¼·')) {
                fortune += 'éå¸¸ã«å¼·ã„ã‚¨ãƒãƒ«ã‚®ãƒ¼ã¨å®Ÿè¡ŒåŠ›ã‚’æŒã¡ã€å›°é›£ãªçŠ¶æ³ã§ã‚‚çªç ´ã§ãã‚‹åŠ›ãŒã‚ã‚Šã¾ã™ã€‚';
                fortune += 'ãã®å¼·å¤§ãªåŠ›ã‚’ç¤¾ä¼šè²¢çŒ®ã‚„å‰µé€ çš„ãªæ´»å‹•ã«å‘ã‘ã‚‹ã“ã¨ã§ã€å¤§ããªæˆåŠŸã‚’åã‚ã‚‰ã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚';
                fortune += 'è¬™è™šã•ã¨æŸ”è»Ÿæ€§ã‚’å¿˜ã‚Œãšã«ã€å‘¨å›²ã¨ã®èª¿å’Œã‚’ä¿ã¤ã“ã¨ãŒé•·æœŸçš„ãªæˆåŠŸã®éµã¨ãªã‚Šã¾ã™ã€‚';
            } else if (strength.includes('èº«å¼·')) {
                fortune += 'å¼·ã„å€‹æ€§ã¨å®Ÿè¡ŒåŠ›ã‚’æŒã£ã¦ã„ã‚‹ãŸã‚ã€ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’ç™ºæ®ã™ã‚‹å ´é¢ã§æ´»èºã§ãã‚‹ã§ã—ã‚‡ã†ã€‚';
                fortune += 'æ™‚ã«ã¯å‘¨å›²ã®æ„è¦‹ã«è€³ã‚’å‚¾ã‘ã€æŸ”è»Ÿæ€§ã‚’æŒã¤ã“ã¨ã§ã•ã‚‰ãªã‚‹æˆé•·ãŒæœŸå¾…ã§ãã¾ã™ã€‚';
            } else if (strength.includes('èº«å¼±')) {
                fortune += 'å”èª¿æ€§ã¨é©å¿œåŠ›ã«å„ªã‚Œã€ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’å¤§åˆ‡ã«ã™ã‚‹ã“ã¨ã§æˆåŠŸã‚’åã‚ã‚‰ã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚';
                fortune += 'è‡ªåˆ†ã‚’æ”¯ãˆã¦ãã‚Œã‚‹äººé–“é–¢ä¿‚ã‚’å¤§åˆ‡ã«ã—ã€è‡ªä¿¡ã‚’æŒã£ã¦è¡Œå‹•ã™ã‚‹ã“ã¨ãŒé–‹é‹ã®éµã¨ãªã‚Šã¾ã™ã€‚';
            } else if (strength.includes('æ¥µèº«å¼±')) {
                fortune += 'ç¹Šç´°ãªæ„Ÿå—æ€§ã¨æ´å¯ŸåŠ›ã‚’æŒã¡ã€äººã®æ°—æŒã¡ã‚’ç†è§£ã™ã‚‹èƒ½åŠ›ã«å„ªã‚Œã¦ã„ã¾ã™ã€‚';
                fortune += 'ã‚µãƒãƒ¼ã‚¿ãƒ¼çš„ãªç«‹å ´ã§åŠ›ã‚’ç™ºæ®ã—ã€å”åŠ›çš„ãªç’°å¢ƒã§æ‰èƒ½ãŒé–‹èŠ±ã—ã¾ã™ã€‚';
                fortune += 'ç„¡ç†ã‚’ã›ãšè‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã‚’å¤§åˆ‡ã«ã—ã€ä¿¡é ¼ã§ãã‚‹ä»²é–“ã¨å…±ã«æ­©ã‚€ã“ã¨ã§å¹¸é‹ã‚’å¼•ãå¯„ã›ã‚‰ã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚';
            }
            
            // ä¸è¶³ã—ã¦ã„ã‚‹äº”è¡Œã‹ã‚‰é–‹é‹ã‚¢ãƒ‰ãƒã‚¤ã‚¹
            const minElement = Object.keys(elementCount).reduce((a, b) => 
                elementCount[a] < elementCount[b] ? a : b
            );
            
            const elementAdvice = {
                'æœ¨': 'ç·‘è‰²ã®ã‚‚ã®ã‚’èº«ã«ã¤ã‘ãŸã‚Šã€è¦³è‘‰æ¤ç‰©ã‚’è‚²ã¦ã‚‹ã“ã¨ã§é‹æ°—ãŒä¸Šæ˜‡ã—ã¾ã™ã€‚',
                'ç«': 'èµ¤è‰²ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’å–ã‚Šå…¥ã‚ŒãŸã‚Šã€å¤ªé™½ã®å…‰ã‚’æµ´ã³ã‚‹ã“ã¨ã§æ´»åŠ›ãŒå¢—ã—ã¾ã™ã€‚',
                'åœŸ': 'é»„è‰²ã‚„èŒ¶è‰²ã‚’æ„è­˜ã—ã€å¤§åœ°ã«è§¦ã‚Œã‚‹æ©Ÿä¼šã‚’å¢—ã‚„ã™ã¨å®‰å®šæ„ŸãŒå¢—ã—ã¾ã™ã€‚',
                'é‡‘': 'ç™½è‰²ã‚„é‡‘å±è£½ã®ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼ã‚’èº«ã«ã¤ã‘ã‚‹ã“ã¨ã§æ±ºæ–­åŠ›ãŒé«˜ã¾ã‚Šã¾ã™ã€‚',
                'æ°´': 'é’è‰²ã‚„é»’è‰²ã‚’å–ã‚Šå…¥ã‚Œã€æ°´è¾ºã§éã”ã™æ™‚é–“ã‚’ä½œã‚‹ã¨çŸ¥æµãŒæ·±ã¾ã‚Šã¾ã™ã€‚'
            };
            
            fortune += `\n\nã€é–‹é‹ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã€‘\n${elementAdvice[minElement]}`;
            
            return fortune;
        }
        
        // å¤§é‹è¨ˆç®—
        function calculateDaiunn() {
            const yearStem = document.getElementById('yearStem').value;
            const monthStem = document.getElementById('monthStem').value;
            const monthBranch = document.getElementById('monthBranch').value;
            const dayStem = document.getElementById('dayStem').value;
            
            if (!yearStem || !monthStem || !monthBranch || !window.currentGender || !window.currentBirthDate) {
                return;
            }
            
            const gender = window.currentGender;
            const birthDate = window.currentBirthDate;
            
            // å¹´å¹²ã®é™°é™½åˆ¤å®š
            const yearStemIndex = heavenlyStems.indexOf(yearStem);
            const isYangYear = yearStemIndex % 2 === 0;
            
            // é †è¡Œãƒ»é€†è¡Œã®åˆ¤å®š
            const isForward = (isYangYear && gender === 'male') || (!isYangYear && gender === 'female');
            
            // ç«‹é‹å¹´é½¢ã®è¨ˆç®—ï¼ˆç°¡æ˜“ç‰ˆï¼š3æ­³ã‹ã‚‰é–‹å§‹ã¨ã—ã¦è¨ˆç®—ï¼‰
            const startAge = 3;
            
            // å¤§é‹ã®å¹²æ”¯ã‚’è¨ˆç®—
            const monthStemIndex = heavenlyStems.indexOf(monthStem);
            const monthBranchIndex = earthlyBranches.indexOf(monthBranch);
            
            let daiunnHTML = '<table class="daiunn-table">';
            daiunnHTML += '<tr><th>å¹´é½¢</th><th>å¤§é‹å¤©å¹²</th><th>å¤§é‹åœ°æ”¯</th><th>åç¥</th><th>é‹å‹¢å‚¾å‘</th></tr>';
            
            for (let i = 0; i < 8; i++) {
                const age = startAge + (i * 10);
                let stemIndex, branchIndex;
                
                if (isForward) {
                    stemIndex = (monthStemIndex + i + 1) % 10;
                    branchIndex = (monthBranchIndex + i + 1) % 12;
                } else {
                    stemIndex = (monthStemIndex - i - 1 + 10) % 10;
                    branchIndex = (monthBranchIndex - i - 1 + 12) % 12;
                }
                
                const daiunnStem = heavenlyStems[stemIndex];
                const daiunnBranch = earthlyBranches[branchIndex];
                const tenGod = getTenGod(dayStem, daiunnStem);
                const fortune = getDaiunnFortune(tenGod, i);
                
                daiunnHTML += `<tr>`;
                daiunnHTML += `<td>${age}æ­³ï½${age+9}æ­³</td>`;
                daiunnHTML += `<td>${daiunnStem}</td>`;
                daiunnHTML += `<td>${daiunnBranch}</td>`;
                daiunnHTML += `<td>${tenGod}</td>`;
                daiunnHTML += `<td>${fortune}</td>`;
                daiunnHTML += `</tr>`;
            }
            
            daiunnHTML += '</table>';
            
            document.getElementById('daiunnResult').innerHTML = daiunnHTML;
            document.getElementById('daiunnSection').style.display = 'block';
        }
        
        // å¤§é‹ã®é‹å‹¢å‚¾å‘
        function getDaiunnFortune(tenGod, period) {
            const fortunes = {
                'æ¯”è‚©': 'ç‹¬ç«‹å¿ƒãŒå¼·ã¾ã‚Šã€è‡ªåˆ†ã®é“ã‚’åˆ‡ã‚Šé–‹ãæ™‚æœŸ',
                'åŠ«è²¡': 'å”åŠ›è€…ã¨ã®å‡ºä¼šã„ã€ç«¶äº‰å¿ƒãŒé«˜ã¾ã‚‹æ™‚æœŸ',
                'é£Ÿç¥': 'æ‰èƒ½é–‹èŠ±ã€æ¥½ã—ã¿ã‚„è¶£å‘³ãŒå……å®Ÿã™ã‚‹æ™‚æœŸ',
                'å‚·å®˜': 'å‰µé€ æ€§ç™ºæ®ã€å¤‰é©ã‚„æŒ‘æˆ¦ã®æ™‚æœŸ',
                'æ­£è²¡': 'çµŒæ¸ˆçš„å®‰å®šã€å …å®Ÿãªæˆæœã‚’å¾—ã‚‹æ™‚æœŸ',
                'åè²¡': 'è‡¨æ™‚åå…¥ã€ãƒãƒ£ãƒ³ã‚¹ã‚„å¹¸é‹ã«æµã¾ã‚Œã‚‹æ™‚æœŸ',
                'æ­£å®˜': 'ç¤¾ä¼šçš„åœ°ä½å‘ä¸Šã€è²¬ä»»ã‚ã‚‹ç«‹å ´ã«ã¤ãæ™‚æœŸ',
                'åå®˜': 'å®ŸåŠ›ç™ºæ®ã€å›°é›£ã‚’ä¹—ã‚Šè¶Šãˆã‚‹æ™‚æœŸ',
                'å°ç¶¬': 'å­¦ç¿’ã¨æˆé•·ã€çŸ¥è­˜ã‚„æŠ€è¡“ç¿’å¾—ã®æ™‚æœŸ',
                'åå°': 'ç‹¬å‰µæ€§ç™ºæ®ã€æ–°ã—ã„åˆ†é‡ã¸ã®æŒ‘æˆ¦ã®æ™‚æœŸ'
            };
            
            return fortunes[tenGod] || 'å¤‰åŒ–ã¨æˆé•·ã®æ™‚æœŸ';
        }
    </script>
</body>
</html>
